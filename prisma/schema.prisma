generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id                  String      @id @default(uuid())
  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt
  status              Boolean     @default(true)
  email_institucional String      @unique
  nome_civil          String
  senha               String?
  professor           Professor?
  secretaria          Secretaria?
  aluno               Aluno?

  @@map("usuario")
}

model Secretaria {
  id                     String                 @id @default(uuid())
  createdAt              DateTime               @default(now())
  updatedAt              DateTime               @updatedAt
  usuario_id             String                 @unique
  acesso_admin           Boolean
  email_pessoal          String?
  celular                String?
  cpf                    String?
  nome_social            String?
  solicitacao_defesa     SolicitacaoDefesa[]
  programa_pos_graduacao ProgramaPosGraduacao[]
  usuario                Usuario                @relation(fields: [usuario_id], references: [id])

  @@map("secretaria")
}

model Aluno {
  id                        String                @id @default(uuid())
  createdAt                 DateTime              @default(now())
  updatedAt                 DateTime              @updatedAt
  usuario_id                String                @unique
  qualificacao              Qualificacao
  ra                        String?
  programa_pos_graduacao_id String?
  email_pessoal             String?
  cpf                       String?
  nome_social               String?
  celular                   String?
  data_de_ingresso          DateTime?
  aluno_professor           AlunoProfessor[]
  solicitacao_defesa        SolicitacaoDefesa[]
  usuario                   Usuario               @relation(fields: [usuario_id], references: [id])
  programa_pos_graduacao    ProgramaPosGraduacao? @relation(fields: [programa_pos_graduacao_id], references: [id])

  @@map("aluno")
}

model Professor {
  id                        String                      @id @default(uuid())
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime                    @updatedAt
  pertence_uem              Boolean                     @default(true)
  usuario_id                String?                     @unique
  qualificacao              Qualificacao
  cpf                       String?
  formacao_origem           String?
  area_atuacao              String?
  titulacao                 String?
  nome_social               String?
  celular                   String?
  email_membro_externo      String?
  programa_pos_graduacao_id String?
  aluno_professor           AlunoProfessor[]
  SolicitacaoBancaProfessor SolicitacaoBancaProfessor[]
  usuario                   Usuario?                    @relation(fields: [usuario_id], references: [id])
  programa_pos_graduacao    ProgramaPosGraduacao?       @relation(fields: [programa_pos_graduacao_id], references: [id])

  @@map("professor")
}

model ProgramaPosGraduacao {
  id                String           @id @default(uuid())
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  status            Boolean          @default(true)
  tipo              Qualificacao
  categoria         ModoApresentacao
  codigo            BigInt
  linha_de_pesquisa String
  curso             String
  cidade            String?
  departamento      String?
  secretaria_id     String
  alunos            Aluno[]
  professores       Professor[]
  secretaria        Secretaria       @relation(fields: [secretaria_id], references: [id])

  @@map("programa_pos_graduacao")
}

model AlunoProfessor {
  id           String    @id @default(uuid())
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  aluno_id     String
  professor_id String
  coorientador Boolean
  aluno        Aluno     @relation(fields: [aluno_id], references: [id])
  professor    Professor @relation(fields: [professor_id], references: [id])

  @@map("aluno_professor")
}

model SolicitacaoBancaProfessor {
  id                    String            @id @default(uuid())
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt
  solicitacao_defesa_id String
  professor_id          String
  suplente              Boolean
  copia_impressa        Boolean
  solicitacao_defesa    SolicitacaoDefesa @relation(fields: [solicitacao_defesa_id], references: [id])
  professor             Professor         @relation(fields: [professor_id], references: [id])

  @@map("solicitacao_banca_professor")
}

model SolicitacaoDefesa {
  id                   String                      @id @default(uuid())
  createdAt            DateTime                    @default(now())
  updatedAt            DateTime                    @updatedAt
  modalidade_defesa    ModoApresentacao
  data_defesa          DateTime
  horario_defesa       DateTime
  secretaria_id        String
  aluno_solicitante_id String
  titulo_trabalho      String
  cidade               String?
  bloco                String?
  sala                 String?
  link_remoto          String?
  justificativa        String?
  tipo_defesa          TipoDefesa
  anexo                Anexo[]
  professores_banca    SolicitacaoBancaProfessor[]
  status               StatusSolicitacao           @default(PENDENTE)
  secretaria           Secretaria                  @relation(fields: [secretaria_id], references: [id])
  aluno                Aluno                       @relation(fields: [aluno_solicitante_id], references: [id])

  @@map("solicitacao_defesa")
}

model Anexo {
  id                    String            @id @default(uuid())
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt
  solicitacao_defesa_id String
  nome_arquivo          String
  hash                  String
  url                   String
  tipo                  TipoAnexo
  solicitacao_defesa    SolicitacaoDefesa @relation(fields: [solicitacao_defesa_id], references: [id])

  @@map("solicitacao_defesa_anexo")
}

enum Qualificacao {
  MESTRADO
  DOUTORADO
}

enum ModoApresentacao {
  PRESENCIAL
  REMOTO
  HIBRIDO
}

enum TipoDefesa {
  QUALIFICACAO_MESTRADO
  QUALIFICACAO_DOUTORADO
  DEFESA_DISSERTACAO_MESTRADO
  DEFESA_TESE_DOUTORADO
}

enum StatusSolicitacao {
  APROVADO
  REPROVADO
  PENDENTE
  APROVADO_PELO_CONSELHO
}

enum TipoAnexo {
  TEXTO_TRABALHO
  COMPROVANTE_PUBLICACAO
  PROPOSTA_QUALIFICACAO
  DISSERTACAO_FINAL
  TESE_FINAL
  AUTORIZACAO_ORIENTADOR
  CURRICULO_LATTES_MEMBRO_EXTERNO
  CURRICULO_LATTES_MEMBRO_ESTRANGEIRO
}
